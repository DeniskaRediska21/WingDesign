import aerosandbox as asb
import aerosandbox.numpy as np
import numpy as np_standard
import matplotlib.pyplot as plt
import matplotlib
from matplotlib.patches import Polygon
import time
from math import sin, cos, radians, degrees
import sys

matplotlib.use('TkAgg')


# ============================================================================
# –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ó–ê–î–ê–ß–ò
# ============================================================================

class MissionProfile:
    """–ö–ª–∞—Å—Å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∏—Å—Å–∏–∏"""

    PROFILES = {
        'long': {  # –î–ê–õ–¨–ù–ò–ô –ü–û–õ–Å–¢ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å)
            'min_quality': 18,
            'min_cl_max': 1.0,
            'max_stall_speed': 10,
            'target_cruise_speed': 12,
            'max_power': 200,
            'weight_penalty': 0.3,
        },
        'fast': {  # –ë–´–°–¢–†–´–ô –ü–û–õ–Å–¢ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å)
            'min_quality': 12,
            'min_cl_max': 0.8,
            'max_stall_speed': 15,
            'target_cruise_speed': 25,
            'max_power': 400,
            'weight_penalty': 0.1,
        },
        'vtol': {  # –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–ô –í–ó–õ–Å–¢ + –ø–æ–ª—ë—Ç
            'min_quality': 14,
            'min_cl_max': 1.4,
            'max_stall_speed': 8,
            'target_cruise_speed': 15,
            'max_power': 300,
            'weight_penalty': 0.5,
        },
        'acrobatic': {  # –ê–≠–†–û–ë–ê–¢–ò–ö–ê
            'min_quality': 10,
            'min_cl_max': 1.2,
            'max_stall_speed': 12,
            'target_cruise_speed': 20,
            'max_power': 350,
            'weight_penalty': 0.2,
        },
        'glider': {  # –ü–õ–ê–ù–ï–† (—Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
            'min_quality': 25,
            'min_cl_max': 1.1,
            'max_stall_speed': 7,
            'target_cruise_speed': 10,
            'max_power': 0,
            'weight_penalty': 0.7,
        }
    }


# ============================================================================
# –§–£–ù–ö–¶–ò–ò –í–í–û–î–ê –ü–ê–†–ê–ú–ï–¢–†–û–í
# ============================================================================

def get_user_input():
    """–ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    print("=" * 70)
    print("–ö–û–ù–§–ò–ì–£–†–ê–¢–û–† –ö–†–´–õ–ê –î–õ–Ø –û–ü–¢–ò–ú–ê–õ–¨–ù–û–ì–û –ü–û–õ–Å–¢–ê")
    print("=" * 70)

    # –í—ã–±–æ—Ä –º–∏—Å—Å–∏–∏
    print("\nüìã –í–´–ë–ï–†–ò–¢–ï –¢–ò–ü –ü–û–õ–Å–¢–ê:")
    for i, (key, profile) in enumerate(MissionProfile.PROFILES.items(), 1):
        print(f"{i}. {key.upper():10s} - {get_profile_description(key)}")

    while True:
        try:
            choice = int(input("\n–í–∞—à –≤—ã–±–æ—Ä (1-5): ")) - 1
            mission_keys = list(MissionProfile.PROFILES.keys())
            if 0 <= choice < len(mission_keys):
                mission = mission_keys[choice]
                break
            else:
                print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 5")
        except:
            print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ")

    # –í—ã–±–æ—Ä –∫—Ä–∏—Ç–µ—Ä–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    print("\nüéØ –í–´–ë–ï–†–ò–¢–ï –ö–†–ò–¢–ï–†–ò–ô –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò:")
    print("1. –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∫—Ä–∏—Ç–µ—Ä–∏–π")
    print("2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ C_L/C_D - –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–∞–ª—å–Ω–æ—Å—Ç–∏")
    print("3. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π C_L_max - –¥–ª—è –Ω–∏–∑–∫–∏—Ö —Å–∫–æ—Ä–æ—Å—Ç–µ–π/VTOL")
    print("4. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è - –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏")
    print("5. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç—Ä–µ–±—É–µ–º–∞—è –º–æ—â–Ω–æ—Å—Ç—å - –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏")

    criteria_options = {
        1: {'name': '–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞', 'key': 'score', 'reverse': True},
        2: {'name': '–ö–∞—á–µ—Å—Ç–≤–æ C_L/C_D', 'key': 'cruise_quality', 'reverse': True},
        3: {'name': 'C_L_max', 'key': 'CL_max', 'reverse': True},
        4: {'name': '–°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è', 'key': 'stall_speed', 'reverse': False},
        5: {'name': '–ú–æ—â–Ω–æ—Å—Ç—å –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ', 'key': 'cruise_power', 'reverse': False}
    }

    while True:
        try:
            criteria_choice = int(input("\n–í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (1-5, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1): ") or "1")
            if 1 <= criteria_choice <= 5:
                sort_criteria = criteria_options[criteria_choice]
                break
            else:
                print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 5")
        except:
            print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ")

    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∞–º–æ–ª—ë—Ç–∞
    print("\n‚úàÔ∏è  –ü–ê–†–ê–ú–ï–¢–†–´ –°–ê–ú–û–õ–Å–¢–ê:")

    mass = float(input("–ú–∞—Å—Å–∞ (–∫–≥, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3.0): ") or "3.0")
    wingspan = float(input("–†–∞–∑–º–∞—Ö –∫—Ä—ã–ª–∞ (–º, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.4): ") or "1.4")

    # –î–∏–∞–ø–∞–∑–æ–Ω—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    print("\n‚öôÔ∏è  –î–ò–ê–ü–ê–ó–û–ù–´ –î–õ–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò:")

    print("–•–æ—Ä–¥–∞ –∫–æ—Ä–Ω–µ–≤–∞—è (–º):")
    chord_min = float(input("  –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.15): ") or "0.15")
    chord_max = float(input("  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.25): ") or "0.25")
    chord_steps = int(input("  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3): ") or "3")

    print("\n–°—Ç—Ä–µ–ª–æ–≤–∏–¥–Ω–æ—Å—Ç—å (–≥—Ä–∞–¥):")
    sweep_min = float(input("  –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0): ") or "0")
    sweep_max = float(input("  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30): ") or "30")
    sweep_steps = int(input("  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4): ") or "4")

    print("\n–£–¥–ª–∏–Ω–µ–Ω–∏–µ (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–≤–æ–π —Ö–æ—Ä–¥—ã –∫ –∫–æ—Ä–Ω–µ–≤–æ–π):")
    ar_min = float(input("  –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.4): ") or "0.4")
    ar_max = float(input("  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.8): ") or "0.8")
    ar_steps = int(input("  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3): ") or "3")

    print("\n–£–≥–æ–ª —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —Å–µ—á–µ–Ω–∏—è (–≥—Ä–∞–¥):")
    twist_root_min = float(input("  –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0): ") or "0")
    twist_root_max = float(input("  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5): ") or "5")
    twist_root_steps = int(input("  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏–Æ 3): ") or "3")

    # –ü—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    print("\nüéØ –ü–†–û–§–ò–õ–ò –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏):")
    default_airfoils = ['naca2412', 'naca4412', 'naca4415', 'naca6412',
                        'clarky', 'ag04', 'sd7032', 's1223', 'naca23012']

    print(f"–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: {', '.join(default_airfoils)}")
    custom = input("–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –ø—Ä–æ—Ñ–∏–ª–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –∏–ª–∏ Enter —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å): ")

    if custom.strip():
        custom_airfoils = [af.strip() for af in custom.split(',')]
        airfoils = list(set(default_airfoils + custom_airfoils))
    else:
        airfoils = default_airfoils

    # –°–≤–æ–¥–∫–∞
    print("\n" + "=" * 70)
    print("–°–í–û–î–ö–ê –ü–ê–†–ê–ú–ï–¢–†–û–í:")
    print("=" * 70)
    print(f"–ú–∏—Å—Å–∏—è: {mission.upper()}")
    print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: {sort_criteria['name']}")
    print(f"–ú–∞—Å—Å–∞: {mass} –∫–≥")
    print(f"–†–∞–∑–º–∞—Ö: {wingspan} –º")
    print(f"–•–æ—Ä–¥–∞: {chord_min}-{chord_max} –º ({chord_steps} —à–∞–≥–æ–≤)")
    print(f"–°—Ç—Ä–µ–ª–æ–≤–∏–¥–Ω–æ—Å—Ç—å: {sweep_min}-{sweep_max}¬∞ ({sweep_steps} —à–∞–≥–æ–≤)")
    print(f"–£–¥–ª–∏–Ω–µ–Ω–∏–µ: {ar_min}-{ar_max} ({ar_steps} —à–∞–≥–æ–≤)")
    print(f"–£–≥–æ–ª —É—Å—Ç–∞–Ω–æ–≤–∫–∏: {twist_root_min}-{twist_root_max}¬∞ ({twist_root_steps} —à–∞–≥–æ–≤)")
    print(f"–ü—Ä–æ—Ñ–∏–ª–∏: {len(airfoils)} —à—Ç")

    total_combinations = (chord_steps * sweep_steps * ar_steps *
                          twist_root_steps * len(airfoils))
    print(f"\n–í—Å–µ–≥–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞: {total_combinations:,}")

    confirm = input("\n–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑? (y/n): ").lower()
    if confirm != 'y':
        print("–ê–Ω–∞–ª–∏–∑ –æ—Ç–º–µ–Ω—ë–Ω")
        return None

    return {
        'mission': mission,
        'mass': mass,
        'wingspan': wingspan,
        'chord_range': (chord_min, chord_max, chord_steps),
        'sweep_range': (sweep_min, sweep_max, sweep_steps),
        'ar_range': (ar_min, ar_max, ar_steps),
        'twist_range': (twist_root_min, twist_root_max, twist_root_steps),
        'airfoils': airfoils,
        'sort_criteria': sort_criteria,
        'profile_params': MissionProfile.PROFILES[mission]
    }


def get_profile_description(key):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –º–∏—Å—Å–∏–∏"""
    descriptions = {
        'long': "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
        'fast': "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –ø—Ä–∏–µ–º–ª–µ–º–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
        'vtol': "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –≤–∑–ª—ë—Ç + —Ö–æ—Ä–æ—à–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å",
        'acrobatic': "–í—ã—Å–æ–∫–∞—è –º–∞–Ω—ë–≤—Ä–µ–Ω–Ω–æ—Å—Ç—å, –±–æ–ª—å—à–∏–µ —É–≥–ª—ã –∞—Ç–∞–∫–∏",
        'glider': "–¢–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ"
    }
    return descriptions.get(key, "")


# ============================================================================
# –§–£–ù–ö–¶–ò–ò –°–û–ó–î–ê–ù–ò–Ø –ò –ê–ù–ê–õ–ò–ó–ê –ö–†–´–õ–ê
# ============================================================================

def create_wing_geometry(airfoil_name, params, geometry):
    """–°–æ–∑–¥–∞—ë—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é –∫—Ä—ã–ª–∞ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"""
    try:
        airfoil = asb.Airfoil(airfoil_name)
    except:
        return None

    # –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    root_chord = geometry['root_chord']
    tip_chord = geometry['tip_chord']
    sweep = geometry['sweep']
    twist_root = geometry['twist_root']
    wingspan = params['wingspan']

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    semi_span = wingspan / 2

    # –ö–æ—Ä–Ω–µ–≤–æ–µ —Å–µ—á–µ–Ω–∏–µ
    root_section = asb.WingXSec(
        xyz_le=[0, 0, 0],
        chord=root_chord,
        twist=twist_root,
        airfoil=airfoil,
    )

    # –ö–æ–Ω—Ü–µ–≤–æ–µ —Å–µ—á–µ–Ω–∏–µ (—Å–æ —Å—Ç—Ä–µ–ª–æ–≤–∏–¥–Ω–æ—Å—Ç—å—é)
    x_offset = semi_span * np.tan(radians(sweep))
    tip_section = asb.WingXSec(
        xyz_le=[x_offset, semi_span, 0],
        chord=tip_chord,
        twist=0,
        airfoil=airfoil,
    )

    # –°–æ–∑–¥–∞—ë–º –∫—Ä—ã–ª–æ
    wing = asb.Wing(
        name=f"Wing_{airfoil_name}",
        xyz_le=[0, 0, 0],
        symmetric=True,
        xsecs=[root_section, tip_section],
    )

    # –°–æ–∑–¥–∞—ë–º —Å–∞–º–æ–ª—ë—Ç
    airplane = asb.Airplane(
        name=f"Config_{airfoil_name}",
        wings=[wing],
    )

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–ª–æ—â–∞–¥—å –∫—Ä—ã–ª–∞
    wing_area = 2 * 0.5 * (root_chord + tip_chord) * semi_span

    return airplane, wing_area, semi_span


def analyze_configuration(params, geometry, airfoil_name):
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"""
    mission_params = params['profile_params']

    # –°–æ–∑–¥–∞—ë–º –∫—Ä—ã–ª–æ
    result = create_wing_geometry(airfoil_name, params, geometry)
    if result is None:
        return None

    airplane, wing_area, semi_span = result

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É–¥–ª–∏–Ω–µ–Ω–∏–µ
    aspect_ratio = (params['wingspan'] ** 2) / wing_area

    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω —É–≥–ª–æ–≤ –∞—Ç–∞–∫–∏
    alpha_range = np.linspace(-5, 15, 13)
    CL_list, CD_list = [], []
    quality_list = []

    for alpha in alpha_range:
        try:
            vlm = asb.VortexLatticeMethod(
                airplane=airplane,
                op_point=asb.OperatingPoint(
                    velocity=mission_params['target_cruise_speed'],
                    alpha=alpha,
                ),
            )

            results = vlm.run()
            CL = results.get('CL', 0)
            CD = results.get('CD', 0)

            CL_list.append(CL)
            CD_list.append(CD)

            if CD > 0:
                quality_list.append(CL / CD)
            else:
                quality_list.append(0)

        except:
            CL_list.append(0)
            CD_list.append(0)
            quality_list.append(0)

    if max(CL_list) < 0.1:
        return None

    # –ù–∞—Ö–æ–¥–∏–º –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    max_CL = max(CL_list)
    max_CL_idx = np.argmax(CL_list)
    max_CL_alpha = alpha_range[max_CL_idx]
    CD_at_max_CL = CD_list[max_CL_idx] if max_CL_idx < len(CD_list) else 0

    # C_L –∏ C_D –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —É–≥–ª–µ (4¬∞ –¥–ª—è –∫—Ä–µ–π—Å–µ—Ä–∞)
    target_alpha = 4
    alpha_idx = np.argmin(np.abs(alpha_range - target_alpha))
    CL_target = CL_list[alpha_idx] if alpha_idx < len(CL_list) else 0
    CD_target = CD_list[alpha_idx] if alpha_idx < len(CD_list) else 0

    # –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö
    if CD_target > 0:
        cruise_quality = CL_target / CD_target
    else:
        cruise_quality = 0

    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    max_quality = max(quality_list) if quality_list else 0
    max_quality_idx = np.argmax(quality_list) if max_quality > 0 else 0
    max_quality_alpha = alpha_range[max_quality_idx]
    CL_at_max_quality = CL_list[max_quality_idx] if max_quality_idx < len(CL_list) else 0
    CD_at_max_quality = CD_list[max_quality_idx] if max_quality_idx < len(CD_list) else 0

    # –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø–æ–¥—ä–µ–º–Ω–æ–π —Å–∏–ª–µ
    if max_CL_idx < len(quality_list):
        quality_at_max_CL = quality_list[max_CL_idx]
    else:
        quality_at_max_CL = 0

    # –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è
    rho = 1.225
    stall_speed = ((2 * params['mass'] * 9.81) / (rho * wing_area * max_CL)) ** 0.5

    # –ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏ —Ü–µ–ª–µ–≤–æ–º C_L
    if CL_target > 0:
        cruise_speed = ((2 * params['mass'] * 9.81) / (rho * wing_area * CL_target)) ** 0.5
    else:
        cruise_speed = 0

    # –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º –∫–∞—á–µ—Å—Ç–≤–µ
    if CL_at_max_quality > 0:
        speed_at_max_quality = ((2 * params['mass'] * 9.81) / (rho * wing_area * CL_at_max_quality)) ** 0.5
    else:
        speed_at_max_quality = 0

    # –ú–æ—â–Ω–æ—Å—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö
    cruise_power = 0.5 * rho * cruise_speed ** 3 * wing_area * CD_target
    power_at_max_quality = 0.5 * rho * speed_at_max_quality ** 3 * wing_area * CD_at_max_quality

    # –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –≤–∑–ª—ë—Ç
    vertical_power = 0
    if mission_params['max_power'] > 0:
        climb_rate = 2
        vertical_thrust = params['mass'] * 9.81 * 1.2
        vertical_power = vertical_thrust * climb_rate

    # –û–¶–ï–ù–ö–ê –ü–†–ò–ì–û–î–ù–û–°–¢–ò
    score = 0

    # –û—Å–Ω–æ–≤–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
    if max_CL >= mission_params['min_cl_max']:
        score += 3
    if stall_speed <= mission_params['max_stall_speed']:
        score += 3
    if cruise_quality >= mission_params['min_quality']:
        score += 4

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
    mission = params['mission']

    if mission == 'long':
        score += cruise_quality * 2
        score += max_quality * 1.5
        score -= stall_speed * 0.5
        if cruise_power < 100:
            score += 2

    elif mission == 'fast':
        score += cruise_speed * 0.5
        score -= stall_speed * 0.3
        if cruise_power < mission_params['max_power']:
            score += 2

    elif mission == 'vtol':
        score += max_CL * 2
        if vertical_power < mission_params['max_power']:
            score += 4
        score -= stall_speed * 0.8

    elif mission == 'acrobatic':
        score += max_CL * 1.5
        valid_alphas = sum(1 for q in quality_list if q > max_quality * 0.7)
        score += valid_alphas * 0.3

    elif mission == 'glider':
        score += cruise_quality * 2
        score += max_quality * 3
        score -= stall_speed
        if wing_area < 0.5:
            score += 1

    # –®—Ç—Ä–∞—Ñ –∑–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Ü–µ–ª–µ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
    speed_diff = abs(cruise_speed - mission_params['target_cruise_speed'])
    score -= speed_diff * 0.2

    # –®—Ç—Ä–∞—Ñ –∑–∞ –≤–µ—Å
    score -= wing_area * mission_params['weight_penalty']

    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –í–°–ï–ú–ò –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ C_L –∏ C_D
    return {
        'airfoil': airfoil_name,
        'geometry': geometry.copy(),
        'score': score,

        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        'root_chord': geometry['root_chord'],
        'tip_chord': geometry['tip_chord'],
        'sweep': geometry['sweep'],
        'twist_root': geometry['twist_root'],
        'aspect_ratio': aspect_ratio,
        'wing_area': wing_area,

        # –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´ –ü–û–î–™–Å–ú–ù–û–ô –°–ò–õ–´ (C_L)
        'CL_max': max_CL,
        'CL_max_alpha': max_CL_alpha,
        'CL_target': CL_target,
        'CL_at_max_quality': CL_at_max_quality,

        # –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´ –°–û–ü–†–û–¢–ò–í–õ–ï–ù–ò–Ø (C_D)
        'CD_target': CD_target,
        'CD_at_max_CL': CD_at_max_CL,
        'CD_at_max_quality': CD_at_max_quality,

        # –ö–ê–ß–ï–°–¢–í–ê (C_L/C_D)
        'cruise_quality': cruise_quality,
        'max_quality': max_quality,
        'max_quality_alpha': max_quality_alpha,
        'quality_at_max_CL': quality_at_max_CL,

        # –°–∫–æ—Ä–æ—Å—Ç–∏
        'stall_speed': stall_speed,
        'cruise_speed': cruise_speed,
        'speed_at_max_quality': speed_at_max_quality,

        # –ú–æ—â–Ω–æ—Å—Ç–∏
        'cruise_power': cruise_power,
        'power_at_max_quality': power_at_max_quality,
        'vertical_power': vertical_power,

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
        'meets_cl': max_CL >= mission_params['min_cl_max'],
        'meets_quality': cruise_quality >= mission_params['min_quality'],
        'meets_stall': stall_speed <= mission_params['max_stall_speed'],
        'meets_power': vertical_power <= mission_params['max_power'],

        'all_requirements': (
                max_CL >= mission_params['min_cl_max'] and
                cruise_quality >= mission_params['min_quality'] and
                stall_speed <= mission_params['max_stall_speed'] and
                vertical_power <= mission_params['max_power']
        )
    }


# ============================================================================
# –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –° –í–´–í–û–î–û–ú C_L –ò C_D
# ============================================================================

def draw_wing_geometry(results, params):
    """–†–∏—Å—É–µ—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫—Ä—ã–ª–∞ —Å –≤—ã–≤–æ–¥–æ–º C_L –∏ C_D"""
    fig = plt.figure(figsize=(16, 12))

    # 1. –¢—Ä—ë—Ö–ø—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω—ã–π —á–µ—Ä—Ç—ë–∂
    ax1 = plt.subplot(3, 3, 1, projection='3d')

    # –°–æ–∑–¥–∞—ë–º –∫—Ä—ã–ª–æ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
    airfoil_name = results['airfoil']
    geometry = results['geometry']

    result = create_wing_geometry(airfoil_name, params, geometry)
    if result:
        airplane, _, _ = result

        root_chord = geometry['root_chord']
        tip_chord = geometry['tip_chord']
        sweep = geometry['sweep']
        semi_span = params['wingspan'] / 2

        # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ–¥–Ω–µ–π –∫—Ä–æ–º–∫–∏
        x_root = 0
        x_tip = semi_span * np.tan(radians(sweep))

        # –†–∏—Å—É–µ–º –∫–æ–Ω—Ç—É—Ä –∫—Ä—ã–ª–∞
        ax1.plot([x_root, x_tip], [0, semi_span], [0, 0], 'b-', linewidth=2, label='–ü–µ—Ä–µ–¥–Ω—è—è –∫—Ä–æ–º–∫–∞')
        ax1.plot([x_root + root_chord, x_tip + tip_chord], [0, semi_span], [0, 0], 'r-', linewidth=2,
                 label='–ó–∞–¥–Ω—è—è –∫—Ä–æ–º–∫–∞')
        ax1.plot([x_root, x_root + root_chord], [0, 0], [0, 0], 'g-', linewidth=2, label='–ö–æ—Ä–Ω–µ–≤–∞—è —Ö–æ—Ä–¥–∞')
        ax1.plot([x_tip, x_tip + tip_chord], [semi_span, semi_span], [0, 0], 'g-', linewidth=2, label='–ö–æ–Ω—Ü–µ–≤–∞—è —Ö–æ—Ä–¥–∞')

        ax1.set_xlabel('X (—Å—Ç—Ä–µ–ª–æ–≤–∏–¥–Ω–æ—Å—Ç—å)')
        ax1.set_ylabel('Y (—Ä–∞–∑–º–∞—Ö)')
        ax1.set_zlabel('Z')
        ax1.set_title(f'3D –≤–∏–¥ –∫—Ä—ã–ª–∞\n{airfoil_name}')
        ax1.legend()

    # 2. –í–∏–¥ —Å–≤–µ—Ä—Ö—É
    ax2 = plt.subplot(3, 3, 2)

    wing_patch = Polygon([
        [x_root, 0],
        [x_tip, semi_span],
        [x_tip + tip_chord, semi_span],
        [x_root + root_chord, 0]
    ], closed=True, alpha=0.3, color='blue')

    ax2.add_patch(wing_patch)
    ax2.plot([x_root, x_root + root_chord], [0, 0], 'r-', linewidth=2, label=f'–ö–æ—Ä–Ω–µ–≤–∞—è —Ö–æ—Ä–¥–∞: {root_chord:.3f} –º')
    ax2.plot([x_tip, x_tip + tip_chord], [semi_span, semi_span], 'g-', linewidth=2,
             label=f'–ö–æ–Ω—Ü–µ–≤–∞—è —Ö–æ—Ä–¥–∞: {tip_chord:.3f} –º')
    ax2.plot([x_root, x_tip], [0, semi_span], 'b-', linewidth=2)
    ax2.plot([x_root + root_chord, x_tip + tip_chord], [0, semi_span], 'b-', linewidth=2)

    ax2.set_xlabel('X (–º)')
    ax2.set_ylabel('Y (–º)')
    ax2.set_title('–í–∏–¥ —Å–≤–µ—Ä—Ö—É')
    ax2.legend()
    ax2.grid(True, alpha=0.3)
    ax2.axis('equal')

    # 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è —Å –í–´–í–û–î–û–ú C_L –∏ C_D
    ax3 = plt.subplot(3, 3, 3)
    ax3.axis('off')

    criteria_name = params.get('sort_criteria', {}).get('name', '–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞')

    info_text = (
        f"–û–ü–¢–ò–ú–ê–õ–¨–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø\n"
        f"–ü—Ä–æ—Ñ–∏–ª—å: {results['airfoil']}\n"
        f"–ú–∏—Å—Å–∏—è: {params['mission'].upper()}\n"
        f"–ö—Ä–∏—Ç–µ—Ä–∏–π: {criteria_name}\n\n"
        f"–ì–ï–û–ú–ï–¢–†–ò–Ø:\n"
        f"–†–∞–∑–º–∞—Ö: {params['wingspan']:.2f} –º\n"
        f"–ü–ª–æ—â–∞–¥—å: {results['wing_area']:.3f} –º¬≤\n"
        f"–£–¥–ª–∏–Ω–µ–Ω–∏–µ: {results['aspect_ratio']:.1f}\n"
        f"–°—Ç—Ä–µ–ª–æ–≤–∏–¥–Ω–æ—Å—Ç—å: {results['sweep']:.1f}¬∞\n"
        f"–•–æ—Ä–¥–∞: {results['root_chord']:.3f}/{results['tip_chord']:.3f} –º\n"
        f"–£–≥–æ–ª —É—Å—Ç–∞–Ω–æ–≤–∫–∏: {results['twist_root']:.1f}¬∞\n\n"
        f"–ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´ –ü–û–î–™–Å–ú–ù–û–ô –°–ò–õ–´ (C_L):\n"
        f"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π C_L: {results['CL_max']:.3f} @ {results['CL_max_alpha']:.1f}¬∞\n"
        f"C_L –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ (4¬∞): {results['CL_target']:.3f}\n"
        f"C_L –ø—Ä–∏ –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–µ: {results['CL_at_max_quality']:.3f} @ {results['max_quality_alpha']:.1f}¬∞\n\n"
        f"–ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´ –°–û–ü–†–û–¢–ò–í–õ–ï–ù–ò–Ø (C_D):\n"
        f"C_D –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ: {results['CD_target']:.4f}\n"
        f"C_D –ø—Ä–∏ C_L_max: {results['CD_at_max_CL']:.4f}\n"
        f"C_D –ø—Ä–∏ –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–µ: {results['CD_at_max_quality']:.4f}\n\n"
        f"–ö–ê–ß–ï–°–¢–í–û (C_L/C_D):\n"
        f"–ù–∞ –∫—Ä–µ–π—Å–µ—Ä–µ: {results['cruise_quality']:.2f} ({results['CL_target']:.3f}/{results['CD_target']:.4f})\n"
        f"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ: {results['max_quality']:.2f} ({results['CL_at_max_quality']:.3f}/{results['CD_at_max_quality']:.4f})\n"
        f"–ü—Ä–∏ C_L_max: {results['quality_at_max_CL']:.2f}\n\n"
        f"–°–ö–û–†–û–°–¢–ò:\n"
        f"–°–≤–∞–ª–∏–≤–∞–Ω–∏—è: {results['stall_speed']:.1f} –º/—Å\n"
        f"–ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è: {results['cruise_speed']:.1f} –º/—Å\n"
        f"–ú–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–∞: {results['speed_at_max_quality']:.1f} –º/—Å"
    )

    ax3.text(0, 1, info_text, transform=ax3.transAxes,
             fontsize=8.5, verticalalignment='top',
             bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))

    # 4. –ì—Ä–∞—Ñ–∏–∫ C_L/C_D –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É–≥–ª–∞ –∞—Ç–∞–∫–∏
    ax4 = plt.subplot(3, 3, (4, 6))

    alpha_test = np_standard.linspace(-5, 15, 21)
    quality_test = []
    CL_test = []
    CD_test = []

    for alpha in alpha_test:
        CL = results['CL_max'] * (1 - (alpha - results['CL_max_alpha']) ** 2 / 400) if results[
                                                                                           'CL_max_alpha'] - 5 < alpha < \
                                                                                       results[
                                                                                           'CL_max_alpha'] + 5 else 0
        CD = 0.02 + CL ** 2 / (np_standard.pi * results['aspect_ratio'] * 0.9)
        CL_test.append(CL)
        CD_test.append(CD)
        quality_test.append(CL / CD if CD > 0 else 0)

    ax4.plot(alpha_test, quality_test, 'b-', linewidth=2, label='–ö–∞—á–µ—Å—Ç–≤–æ C_L/C_D')
    ax4.axvline(x=results['max_quality_alpha'], color='r', linestyle='--',
                label=f'–ú–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–æ @ {results["max_quality_alpha"]:.1f}¬∞')
    ax4.axvline(x=4, color='g', linestyle='--', label='–ö—Ä–µ–π—Å–µ—Ä—Å–∫–∏–π (4¬∞)')
    ax4.axvline(x=results['CL_max_alpha'], color='orange', linestyle='--',
                label=f'C_L_max @ {results["CL_max_alpha"]:.1f}¬∞')

    ax4.set_xlabel('–£–≥–æ–ª –∞—Ç–∞–∫–∏, –≥—Ä–∞–¥—É—Å—ã')
    ax4.set_ylabel('–ö–∞—á–µ—Å—Ç–≤–æ C_L/C_D')
    ax4.set_title('–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç —É–≥–ª–∞ –∞—Ç–∞–∫–∏')
    ax4.grid(True, alpha=0.3)
    ax4.legend()

    # –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ C_L –∏ C_D
    table_data = [
        ['–†–µ–∂–∏–º', '–£–≥–æ–ª (¬∞)', 'C_L', 'C_D', 'C_L/C_D'],
        ['–ö—Ä–µ–π—Å–µ—Ä', '4.0', f"{results['CL_target']:.3f}", f"{results['CD_target']:.4f}",
         f"{results['cruise_quality']:.2f}"],
        ['–ú–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–æ', f"{results['max_quality_alpha']:.1f}", f"{results['CL_at_max_quality']:.3f}",
         f"{results['CD_at_max_quality']:.4f}", f"{results['max_quality']:.2f}"],
        ['–ú–∞–∫—Å. C_L', f"{results['CL_max_alpha']:.1f}", f"{results['CL_max']:.3f}",
         f"{results['CD_at_max_CL']:.4f}", f"{results['quality_at_max_CL']:.2f}"]
    ]

    ax4.text(0.02, 0.98, '–¢–ê–ë–õ–ò–¶–ê –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–û–í:', transform=ax4.transAxes,
             fontsize=9, verticalalignment='top', fontweight='bold')

    y_pos = 0.90
    for i, row in enumerate(table_data):
        if i == 0:
            fontweight = 'bold'
            color = 'black'
        else:
            fontweight = 'normal'
            color = 'blue' if i == 1 else 'red' if i == 2 else 'orange'

        row_text = f"{row[0]:<12} {row[1]:>6} {row[2]:>8} {row[3]:>8} {row[4]:>8}"
        ax4.text(0.02, y_pos, row_text, transform=ax4.transAxes,
                 fontsize=8, verticalalignment='top', fontweight=fontweight, color=color)
        y_pos -= 0.06

    # 5. –†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
    ax5 = plt.subplot(3, 3, 8, polar=True)

    criteria_names = ['–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞', '–ö–∞—á–µ—Å—Ç–≤–æ', 'C_L_max', 'V_—Å–≤–∞–ª–∏–≤–∞–Ω–∏—è', '–ú–æ—â–Ω–æ—Å—Ç—å']
    criteria_values = [
        results['score'] / 20 * 100,
        results['cruise_quality'] / 30 * 100,
        results['CL_max'] / 1.5 * 100,
        (15 - results['stall_speed']) / 15 * 100,
        max(0, 100 - results['cruise_power'] / 500 * 100)
    ]

    angles = np_standard.linspace(0, 2 * np_standard.pi, len(criteria_names), endpoint=False).tolist()
    criteria_values += criteria_values[:1]
    angles += angles[:1]

    ax5.plot(angles, criteria_values, 'o-', linewidth=2)
    ax5.fill(angles, criteria_values, alpha=0.25)
    ax5.set_xticks(angles[:-1])
    ax5.set_xticklabels(criteria_names)
    ax5.set_ylim(0, 100)
    ax5.set_title('–†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫')
    ax5.grid(True)

    plt.suptitle(f'–û–ü–¢–ò–ú–ê–õ–¨–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –î–õ–Ø –ú–ò–°–°–ò–ò: {params["mission"].upper()}',
                 fontsize=14, fontweight='bold')
    plt.tight_layout()
    plt.show()


# ============================================================================
# –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø)
# ============================================================================

def optimize_wing(params):
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏"""
    print("\n" + "=" * 70)
    print("–ù–ê–ß–ê–õ–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò")
    print("=" * 70)
    print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {params['sort_criteria']['name']}")
    print("=" * 70)

    # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    chord_min, chord_max, chord_steps = params['chord_range']
    sweep_min, sweep_max, sweep_steps = params['sweep_range']
    ar_min, ar_max, ar_steps = params['ar_range']
    twist_min, twist_max, twist_steps = params['twist_range']

    # –°–æ–∑–¥–∞—ë–º —Å–µ—Ç–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    root_chords = np.linspace(chord_min, chord_max, chord_steps)
    sweeps = np.linspace(sweep_min, sweep_max, sweep_steps)
    aspect_ratios = np.linspace(ar_min, ar_max, ar_steps)
    twists = np.linspace(twist_min, twist_max, twist_steps)

    total_combinations = len(root_chords) * len(sweeps) * len(aspect_ratios) * len(twists) * len(params['airfoils'])

    print(f"\n–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º {total_combinations:,} –∫–æ–º–±–∏–Ω–∞—Ü–∏–π...")
    print("–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.")
    print("-" * 70)

    all_results = []
    start_time = time.time()
    analyzed = 0

    # –ü–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
    for root_chord in root_chords:
        for sweep in sweeps:
            for ar in aspect_ratios:
                for twist in twists:
                    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Ü–µ–≤—É—é —Ö–æ—Ä–¥—É
                    tip_chord = root_chord * ar

                    geometry = {
                        'root_chord': float(root_chord),
                        'tip_chord': float(tip_chord),
                        'sweep': float(sweep),
                        'twist_root': float(twist),
                        'aspect_ratio': float(ar)
                    }

                    for airfoil in params['airfoils']:
                        analyzed += 1

                        # –ü—Ä–æ–≥—Ä–µ—Å—Å
                        if analyzed % 100 == 0:
                            elapsed = time.time() - start_time
                            progress = analyzed / total_combinations * 100
                            eta = elapsed / progress * (100 - progress) if progress > 0 else 0

                            print(f"\r–ü—Ä–æ–≥—Ä–µ—Å—Å: {progress:.1f}% | "
                                  f"–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: {analyzed:,}/{total_combinations:,} | "
                                  f"–í—Ä–µ–º—è: {elapsed:.0f}—Å | "
                                  f"–û—Å—Ç–∞–ª–æ—Å—å: {eta:.0f}—Å", end="")

                        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                        result = analyze_configuration(params, geometry, airfoil)

                        if result:
                            all_results.append(result)

    total_time = time.time() - start_time
    print(f"\n\n–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω –∑–∞ {total_time:.1f} —Å–µ–∫—É–Ω–¥")
    print(f"–£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: {len(all_results)} –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π")

    if not all_results:
        print("\n‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∏ –æ–¥–Ω—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é!")
        return None

    # –°–û–†–¢–ò–†–û–í–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é
    print(f"\n–°–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—é: {params['sort_criteria']['name']}...")

    # –ü–æ–ª—É—á–∞–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    sort_key = params['sort_criteria']['key']
    reverse = params['sort_criteria']['reverse']

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é
    all_results.sort(key=lambda x: x[sort_key], reverse=reverse)

    # –û—Ç–±–∏—Ä–∞–µ–º —Ç–æ–ø-20
    top_results = all_results[:20]

    # –í–´–í–û–î –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –° C_L –∏ C_D
    print("\n" + "=" * 70)
    print(f"–¢–û–ü-10 –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ô –î–õ–Ø –ú–ò–°–°–ò–ò: {params['mission'].upper()}")
    print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {params['sort_criteria']['name']}")
    print("=" * 70)

    for i, res in enumerate(top_results[:10], 1):
        # –ó–Ω–∞—á–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        criteria_value = res[sort_key]
        if sort_key == 'score':
            criteria_display = f"–û—Ü–µ–Ω–∫–∞: {criteria_value:6.1f}"
        elif sort_key == 'cruise_quality':
            criteria_display = f"–ö–∞—á–µ—Å—Ç–≤–æ: {criteria_value:6.2f}"
        elif sort_key == 'CL_max':
            criteria_display = f"C_L_max: {criteria_value:6.3f}"
        elif sort_key == 'stall_speed':
            criteria_display = f"V_—Å–≤–∞–ª–∏–≤–∞–Ω–∏—è: {criteria_value:5.1f} –º/—Å"
        elif sort_key == 'cruise_power':
            criteria_display = f"–ú–æ—â–Ω–æ—Å—Ç—å: {criteria_value:5.0f} –í—Ç"
        else:
            criteria_display = f"–ö—Ä–∏—Ç–µ—Ä–∏–π: {criteria_value:6.2f}"

        print(f"\n{i:2d}. {res['airfoil']:12s} | {criteria_display}")
        print(f"    –ì–µ–æ–º–µ—Ç—Ä–∏—è: —Ö–æ—Ä–¥–∞={res['root_chord']:.3f}/{res['tip_chord']:.3f} –º, "
              f"—Å—Ç—Ä–µ–ª={res['sweep']:.1f}¬∞, AR={res['aspect_ratio']:.2f}, —É—Å—Ç–∞–Ω–æ–≤–∫–∞={res['twist_root']:.1f}¬∞")

        # –í–´–í–û–î –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–û–í C_L –∏ C_D –î–õ–Ø –ö–ê–ñ–î–û–ô –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
        print(f"    C_L: max={res['CL_max']:.3f} @ {res['CL_max_alpha']:.1f}¬∞, "
              f"–∫—Ä–µ–π—Å–µ—Ä={res['CL_target']:.3f}, –º–∞–∫—Å.–∫–∞—á={res['CL_at_max_quality']:.3f}")
        print(f"    C_D: –∫—Ä–µ–π—Å–µ—Ä={res['CD_target']:.4f}, –ø—Ä–∏ C_L_max={res['CD_at_max_CL']:.4f}, "
              f"–º–∞–∫—Å.–∫–∞—á={res['CD_at_max_quality']:.4f}")
        print(f"    –ö–∞—á–µ—Å—Ç–≤–æ: –∫—Ä–µ–π—Å–µ—Ä={res['cruise_quality']:.2f} ({res['CL_target']:.3f}/{res['CD_target']:.4f}), "
              f"–º–∞–∫—Å={res['max_quality']:.2f} ({res['CL_at_max_quality']:.3f}/{res['CD_at_max_quality']:.4f})")
        print(f"    V: —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è={res['stall_speed']:.1f} –º/—Å, "
              f"–∫—Ä–µ–π—Å–µ—Ä={res['cruise_speed']:.1f} –º/—Å, –º–æ—â–Ω–æ—Å—Ç—å={res['cruise_power']:.0f} –í—Ç")

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
        req_status = []
        if res['meets_cl']: req_status.append("C_L_max ‚úì")
        if res['meets_quality']: req_status.append("–ö–∞—á–µ—Å—Ç–≤–æ ‚úì")
        if res['meets_stall']: req_status.append("–°–≤–∞–ª–∏–≤–∞–Ω–∏–µ ‚úì")
        if res['meets_power'] or params['profile_params']['max_power'] == 0:
            req_status.append("–ú–æ—â–Ω–æ—Å—Ç—å ‚úì")

        if req_status:
            print(f"    –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: {', '.join(req_status)}")

    # –õ—É—á—à–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    best_result = top_results[0]

    print("\n" + "=" * 70)
    print("üèÜ –ù–ê–ò–õ–£–ß–®–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:")
    print("=" * 70)

    print(f"–ü—Ä–æ—Ñ–∏–ª—å: {best_result['airfoil']}")
    print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π ({params['sort_criteria']['name']}): {best_result[sort_key]:.3f}")
    print(f"–ì–µ–æ–º–µ—Ç—Ä–∏—è: —Ö–æ—Ä–¥–∞ {best_result['root_chord']:.3f}/{best_result['tip_chord']:.3f} –º, "
          f"—Å—Ç—Ä–µ–ª–æ–≤–∏–¥–Ω–æ—Å—Ç—å {best_result['sweep']:.1f}¬∞, AR={best_result['aspect_ratio']:.2f}, "
          f"—É—Å—Ç–∞–Ω–æ–≤–∫–∞={best_result['twist_root']:.1f}¬∞")

    # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –ª—É—á—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    print(f"\nüìä –ü–û–î–†–û–ë–ù–´–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´:")
    print(
        f"   C_L_max:    {best_result['CL_max']:.3f} @ {best_result['CL_max_alpha']:.1f}¬∞ (C_D={best_result['CD_at_max_CL']:.4f})")
    print(f"   C_L –∫—Ä–µ–π—Å:  {best_result['CL_target']:.3f} @ 4.0¬∞ (C_D={best_result['CD_target']:.4f})")
    print(
        f"   C_L –º–∞–∫—Å.–∫: {best_result['CL_at_max_quality']:.3f} @ {best_result['max_quality_alpha']:.1f}¬∞ (C_D={best_result['CD_at_max_quality']:.4f})")

    print(f"\nüìä –ö–ê–ß–ï–°–¢–í–û (C_L/C_D):")
    print(
        f"   –ö—Ä–µ–π—Å–µ—Ä—Å–∫–æ–µ: {best_result['cruise_quality']:.2f} = {best_result['CL_target']:.3f} / {best_result['CD_target']:.4f}")
    print(
        f"   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ: {best_result['max_quality']:.2f} = {best_result['CL_at_max_quality']:.3f} / {best_result['CD_at_max_quality']:.4f}")
    print(
        f"   –ü—Ä–∏ C_L_max:  {best_result['quality_at_max_CL']:.2f} = {best_result['CL_max']:.3f} / {best_result['CD_at_max_CL']:.4f}")

    print(f"\nüöÄ –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò –ü–û–õ–Å–¢–ê:")
    print(f"   –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è: {best_result['stall_speed']:.1f} –º/—Å")
    print(f"   –ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: {best_result['cruise_speed']:.1f} –º/—Å")
    print(f"   –°–∫–æ—Ä–æ—Å—Ç—å –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–∞: {best_result['speed_at_max_quality']:.1f} –º/—Å")
    print(f"   –ú–æ—â–Ω–æ—Å—Ç—å –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ: {best_result['cruise_power']:.0f} –í—Ç")
    print(f"   –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: {best_result['score']:.1f}/20")

    # –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –ª—É—á—à—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    draw_wing_geometry(best_result, params)

    # –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
    print(f"\nüìà –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:")
    print(f"   ‚Ä¢ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –æ—Ç–≤–µ—á–∞—é—â–∏—Ö –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º: "
          f"{sum(1 for r in all_results if r['all_requirements'])}")

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—á–µ—Å—Ç–≤–∞–º –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º
    if len(all_results) > 0:
        # C_L —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        cl_max_values = [r['CL_max'] for r in all_results]
        cl_cruise_values = [r['CL_target'] for r in all_results]
        print(f"   ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π C_L_max: {np.mean(cl_max_values):.3f}")
        print(f"   ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π C_L_max: {max(cl_max_values):.3f}")
        print(f"   ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π C_L –∫—Ä–µ–π—Å–µ—Ä: {np.mean(cl_cruise_values):.3f}")

        # C_D —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        cd_cruise_values = [r['CD_target'] for r in all_results]
        print(f"   ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π C_D –∫—Ä–µ–π—Å–µ—Ä: {np.mean(cd_cruise_values):.4f}")
        print(f"   ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π C_D –∫—Ä–µ–π—Å–µ—Ä: {min(cd_cruise_values):.4f}")

        # –ö–∞—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        qualities = [r['cruise_quality'] for r in all_results]
        max_qualities = [r['max_quality'] for r in all_results]
        print(f"   ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–∫—Ä–µ–π—Å–µ—Ä): {np.mean(qualities):.2f}")
        print(f"   ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–∫—Ä–µ–π—Å–µ—Ä): {max(qualities):.2f}")
        print(f"   ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–≤–æ–æ–±—â–µ): {max(max_qualities):.2f}")

        # –¢–æ–ø-3 –ø–æ –∫–∞—á–µ—Å—Ç–≤—É —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏
        sorted_by_quality = sorted(all_results, key=lambda x: x['max_quality'], reverse=True)
        print(f"\n   ü•á –¢–û–ü-3 –ü–û –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ú–£ –ö–ê–ß–ï–°–¢–í–£:")
        for i, r in enumerate(sorted_by_quality[:3], 1):
            print(f"     {i}. {r['airfoil']:12s}: –∫–∞—á–µ—Å—Ç–≤–æ={r['max_quality']:.2f} "
                  f"(C_L={r['CL_at_max_quality']:.3f}/C_D={r['CD_at_max_quality']:.4f}) @ {r['max_quality_alpha']:.1f}¬∞")

        # –¢–æ–ø-3 –ø–æ C_L_max
        sorted_by_cl_max = sorted(all_results, key=lambda x: x['CL_max'], reverse=True)
        print(f"\n   ü•á –¢–û–ü-3 –ü–û C_L_max:")
        for i, r in enumerate(sorted_by_cl_max[:3], 1):
            print(f"     {i}. {r['airfoil']:12s}: C_L_max={r['CL_max']:.3f} "
                  f"(C_D={r['CD_at_max_CL']:.4f}) @ {r['CL_max_alpha']:.1f}¬∞")

        # –¢–æ–ø-3 –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É C_D
        sorted_by_min_cd = sorted(all_results, key=lambda x: x['CD_target'])
        print(f"\n   ü•á –¢–û–ü-3 –ü–û –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ú–£ C_D (–∫—Ä–µ–π—Å–µ—Ä):")
        for i, r in enumerate(sorted_by_min_cd[:3], 1):
            print(f"     {i}. {r['airfoil']:12s}: C_D={r['CD_target']:.4f} "
                  f"(C_L={r['CL_target']:.3f}, –∫–∞—á–µ—Å—Ç–≤–æ={r['cruise_quality']:.2f})")

    print(f"   ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è: {min([r['stall_speed'] for r in all_results]):.1f} –º/—Å")
    print(f"   ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å: {min([r['cruise_power'] for r in all_results if r['cruise_power'] > 0]):.0f} –í—Ç")

    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è
    mission = params['mission']
    criteria_name = params['sort_criteria']['name']

    print(f"\nüí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ö–†–ò–¢–ï–†–ò–Ø '{criteria_name}':")

    if criteria_name == '–ö–∞—á–µ—Å—Ç–≤–æ C_L/C_D':
        print("1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∞–º–∏–Ω–∞—Ä–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ (NACA 6-—Å–µ—Ä–∏–∏, SD7032)")
        print("2. –£–≤–µ–ª–∏—á—å—Ç–µ —É–¥–ª–∏–Ω–µ–Ω–∏–µ –∫—Ä—ã–ª–∞ (–±–æ–ª—å—à–∏–π —Ä–∞–∑–º–∞—Ö –ø—Ä–∏ —Ç–æ–π –∂–µ –ø–ª–æ—â–∞–¥–∏)")
        print("3. –£–º–µ–Ω—å—à–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É –ø—Ä–æ—Ñ–∏–ª—è (10-12% –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)")
        print("4. –õ–µ—Ç–∞–π—Ç–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞")
        print("5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª–∞–¥–∫—É—é –æ—Ç–¥–µ–ª–∫—É –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏")

        # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
        if best_result['max_quality_alpha'] > 0:
            print(f"6. –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –∞—Ç–∞–∫–∏ –¥–ª—è –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–∞: {best_result['max_quality_alpha']:.1f}¬∞")
        print(f"7. –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏ –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–µ: {best_result['speed_at_max_quality']:.1f} –º/—Å")
        print(
            f"8. C_L/C_D –ø—Ä–∏ —ç—Ç–æ–º: {best_result['CL_at_max_quality']:.3f}/{best_result['CD_at_max_quality']:.4f} = {best_result['max_quality']:.2f}")

    elif criteria_name == 'C_L_max':
        print("1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å –≤—ã—Å–æ–∫–æ–π –∫—Ä–∏–≤–∏–∑–Ω–æ–π (S1223, NACA 4415)")
        print("2. –£–≤–µ–ª–∏—á—å—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é —Ç–æ–ª—â–∏–Ω—É (12-18%)")
        print("3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–∞—Ü–∏–∏")
        print("4. –£–º–µ–Ω—å—à–∏—Ç–µ —É–¥–ª–∏–Ω–µ–Ω–∏–µ (–¥–ª—è –ª—É—á—à–µ–π —É–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö —É–≥–ª–∞—Ö)")
        print(f"5. –£–≥–æ–ª –∞—Ç–∞–∫–∏ –¥–ª—è C_L_max: {best_result['CL_max_alpha']:.1f}¬∞")
        print(
            f"6. C_L_max/C_D: {best_result['CL_max']:.3f}/{best_result['CD_at_max_CL']:.4f} = {best_result['quality_at_max_CL']:.2f}")

    elif criteria_name == '–°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è':
        print("1. –£–≤–µ–ª–∏—á—å—Ç–µ –ø–ª–æ—â–∞–¥—å –∫—Ä—ã–ª–∞")
        print("2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å –≤—ã—Å–æ–∫–∏–º C_L_max")
        print("3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–∫—Ä—ã–ª–∫–æ–≤/–ø—Ä–µ–¥–∫—Ä—ã–ª–∫–æ–≤")
        print("4. –£–≤–µ–ª–∏—á—å—Ç–µ —Ä–∞–∑–º–∞—Ö (–Ω–æ –Ω–µ –ø–ª–æ—â–∞–¥—å)")
        print("5. –£–º–µ–Ω—å—à–∏—Ç–µ –º–∞—Å—Å—É —Å–∞–º–æ–ª–µ—Ç–∞")
        print(f"6. –¢–µ–∫—É—â–∏–π C_L_max: {best_result['CL_max']:.3f}")

    elif criteria_name == '–ú–æ—â–Ω–æ—Å—Ç—å –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ':
        print("1. –£–º–µ–Ω—å—à–∏—Ç–µ C_D: –≥–ª–∞–¥–∫–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å, –æ–±—Ç–µ–∫–∞–µ–º—ã–µ —Ñ–æ—Ä–º—ã")
        print("2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ª–∞–º–∏–Ω–∞—Ä–Ω–æ–≥–æ –æ–±—Ç–µ–∫–∞–Ω–∏—è")
        print("3. –£–º–µ–Ω—å—à–∏—Ç–µ –ø–ª–æ—â–∞–¥—å –∫—Ä—ã–ª–∞ (–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É)")
        print("4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –∫—Ä–µ–π—Å–µ—Ä—Å–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å")
        print("5. –£–º–µ–Ω—å—à–∏—Ç–µ –º–∞—Å—Å—É —Å–∞–º–æ–ª–µ—Ç–∞")
        print(f"6. –¢–µ–∫—É—â–∏–π C_D –∫—Ä–µ–π—Å–µ—Ä: {best_result['CD_target']:.4f}")

    else:  # –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
        print("1. –ë–∞–ª–∞–Ω—Å–∏—Ä—É–π—Ç–µ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏")
        print("2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∏—Å—Å–∏–∏")

    # –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∏—Å—Å–∏–∏
    mission_recs = {
        'long': "\nüéØ –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –î–ê–õ–¨–ù–ï–ì–û –ü–û–õ–Å–¢–ê:\n"
                "‚Ä¢ –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ C_L/C–î\n"
                f"‚Ä¢ –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ: {best_result['max_quality']:.2f} –ø—Ä–∏ {best_result['CL_at_max_quality']:.3f}/{best_result['CD_at_max_quality']:.4f}\n"
                f"‚Ä¢ –ö—Ä–µ–π—Å–µ—Ä: {best_result['cruise_quality']:.2f} –ø—Ä–∏ {best_result['CL_target']:.3f}/{best_result['CD_target']:.4f}\n"
                f"‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–∞: {best_result['speed_at_max_quality']:.1f} –º/—Å",

        'fast': "\nüéØ –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ë–´–°–¢–†–û–ì–û –ü–û–õ–Å–¢–ê:\n"
                "‚Ä¢ –£–º–µ–Ω—å—à–∏—Ç–µ C_D –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è\n"
                f"‚Ä¢ –¢–µ–∫—É—â–∏–π C_D –∫—Ä–µ–π—Å–µ—Ä: {best_result['CD_target']:.4f}\n"
                f"‚Ä¢ –ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: {best_result['cruise_speed']:.1f} –º/—Å\n"
                f"‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ: {best_result['cruise_quality']:.2f}",

        'vtol': "\nüéØ –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –í–ï–†–¢–ò–ö–ê–õ–¨–ù–û–ì–û –í–ó–õ–Å–¢–ê:\n"
                "‚Ä¢ –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–π—Ç–µ C_L_max –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –≤–∑–ª–µ—Ç–∞\n"
                f"‚Ä¢ C_L_max: {best_result['CL_max']:.3f} @ {best_result['CL_max_alpha']:.1f}¬∞\n"
                f"‚Ä¢ C_D –ø—Ä–∏ C_L_max: {best_result['CD_at_max_CL']:.4f}\n"
                f"‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è: {best_result['stall_speed']:.1f} –º/—Å",

        'acrobatic': "\nüéØ –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ê–≠–†–û–ë–ê–¢–ò–ö–ò:\n"
                     "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏\n"
                     f"‚Ä¢ C_L_max: {best_result['CL_max']:.3f}\n"
                     f"‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –±–æ–ª—å—à–∏—Ö —É–≥–ª–∞—Ö: {best_result['quality_at_max_CL']:.2f}\n"
                     f"‚Ä¢ C_L/C_D –ø—Ä–∏ —Å–≤–∞–ª–∏–≤–∞–Ω–∏–∏: {best_result['CL_max']:.3f}/{best_result['CD_at_max_CL']:.4f}",

        'glider': "\nüéØ –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ü–õ–ê–ù–ï–†–ê:\n"
                  "‚Ä¢ –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ C_L/C–î!\n"
                  f"‚Ä¢ –ú–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–æ: {best_result['max_quality']:.2f} @ {best_result['max_quality_alpha']:.1f}¬∞\n"
                  f"‚Ä¢ C_L/C_D: {best_result['CL_at_max_quality']:.3f}/{best_result['CD_at_max_quality']:.4f}\n"
                  f"‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–∞: {best_result['speed_at_max_quality']:.1f} –º/—Å\n"
                  f"‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∏—è: {best_result['cruise_speed'] / best_result['max_quality']:.2f} –º/—Å"
    }

    print(mission_recs.get(mission, ""))

    return best_result, top_results


# ============================================================================
# –§–£–ù–ö–¶–ò–Ø –≠–ö–°–ü–û–†–¢–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –° C_L –ò C_D
# ============================================================================

def export_results(best_config, top_configs, params):
    """–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–∞–π–ª —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏"""
    print("\n" + "=" * 70)
    export = input("–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞? (y/n): ")

    if export.lower() == 'y':
        timestamp = time.strftime("%Y%m%d_%H%M%S")
        filename = f"wing_optimization_{params['mission']}_{timestamp}.txt"

        with open(filename, 'w', encoding='utf-8') as f:
            f.write("=" * 70 + "\n")
            f.write(f"–†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ö–†–´–õ–ê\n")
            f.write(f"–ú–∏—Å—Å–∏—è: {params['mission'].upper()}\n")
            f.write(f"–ö—Ä–∏—Ç–µ—Ä–∏–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: {params['sort_criteria']['name']}\n")
            f.write(f"–í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞: {time.strftime('%Y-%m-%d %H:%M:%S')}\n")
            f.write("=" * 70 + "\n\n")

            f.write("–ù–ê–ò–õ–£–ß–®–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:\n")
            f.write("-" * 70 + "\n")
            f.write(f"–ü—Ä–æ—Ñ–∏–ª—å: {best_config['airfoil']}\n")
            f.write(
                f"–ó–Ω–∞—á–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è ({params['sort_criteria']['name']}): {best_config[params['sort_criteria']['key']]:.3f}\n")
            f.write(f"–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: {best_config['score']:.1f}\n\n")

            f.write("–ì–ï–û–ú–ï–¢–†–ò–Ø:\n")
            f.write(f"  –†–∞–∑–º–∞—Ö: {params['wingspan']:.3f} –º\n")
            f.write(f"  –ü–ª–æ—â–∞–¥—å –∫—Ä—ã–ª–∞: {best_config['wing_area']:.3f} –º¬≤\n")
            f.write(f"  –£–¥–ª–∏–Ω–µ–Ω–∏–µ: {best_config['aspect_ratio']:.2f}\n")
            f.write(f"  –°—Ç—Ä–µ–ª–æ–≤–∏–¥–Ω–æ—Å—Ç—å: {best_config['sweep']:.1f}¬∞\n")
            f.write(f"  –•–æ—Ä–¥–∞ –∫–æ—Ä–Ω–µ–≤–∞—è: {best_config['root_chord']:.3f} –º\n")
            f.write(f"  –•–æ—Ä–¥–∞ –∫–æ–Ω—Ü–µ–≤–∞—è: {best_config['tip_chord']:.3f} –º\n")
            f.write(f"  –£–≥–æ–ª —É—Å—Ç–∞–Ω–æ–≤–∫–∏: {best_config['twist_root']:.1f}¬∞\n\n")

            f.write("–î–ï–¢–ê–õ–¨–ù–´–ï –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´ C_L –ò C_D:\n")
            f.write("-" * 70 + "\n")
            f.write(
                f"  C_L_max: {best_config['CL_max']:.3f} @ {best_config['CL_max_alpha']:.1f}¬∞ (C_D={best_config['CD_at_max_CL']:.4f})\n")
            f.write(f"  C_L –∫—Ä–µ–π—Å–µ—Ä—Å–∫–∏–π (4¬∞): {best_config['CL_target']:.3f} (C_D={best_config['CD_target']:.4f})\n")
            f.write(
                f"  C_L –ø—Ä–∏ –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–µ: {best_config['CL_at_max_quality']:.3f} @ {best_config['max_quality_alpha']:.1f}¬∞ (C_D={best_config['CD_at_max_quality']:.4f})\n\n")

            f.write("–ö–ê–ß–ï–°–¢–í–û (C_L/C_D):\n")
            f.write(
                f"  –ö—Ä–µ–π—Å–µ—Ä—Å–∫–æ–µ: {best_config['cruise_quality']:.2f} = {best_config['CL_target']:.3f} / {best_config['CD_target']:.4f}\n")
            f.write(
                f"  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ: {best_config['max_quality']:.2f} = {best_config['CL_at_max_quality']:.3f} / {best_config['CD_at_max_quality']:.4f}\n")
            f.write(
                f"  –ü—Ä–∏ C_L_max: {best_config['quality_at_max_CL']:.2f} = {best_config['CL_max']:.3f} / {best_config['CD_at_max_CL']:.4f}\n\n")

            f.write("–•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò –ü–û–õ–Å–¢–ê:\n")
            f.write(f"  –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–∞–ª–∏–≤–∞–Ω–∏—è: {best_config['stall_speed']:.1f} –º/—Å\n")
            f.write(f"  –ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: {best_config['cruise_speed']:.1f} –º/—Å\n")
            f.write(f"  –°–∫–æ—Ä–æ—Å—Ç—å –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–∞: {best_config['speed_at_max_quality']:.1f} –º/—Å\n")
            f.write(f"  –ú–æ—â–Ω–æ—Å—Ç—å –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ: {best_config['cruise_power']:.0f} –í—Ç\n")
            f.write(f"  –ú–æ—â–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–µ: {best_config['power_at_max_quality']:.0f} –í—Ç\n\n")

            f.write("–û–ü–¢–ò–ú–ê–õ–¨–ù–´–ï –†–ï–ñ–ò–ú–´ –ü–û–õ–ï–¢–ê:\n")
            f.write(f"  1. –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–∞–ª—å–Ω–æ—Å—Ç–∏:\n")
            f.write(f"     ‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å: {best_config['speed_at_max_quality']:.1f} –º/—Å\n")
            f.write(f"     ‚Ä¢ –£–≥–æ–ª –∞—Ç–∞–∫–∏: {best_config['max_quality_alpha']:.1f}¬∞\n")
            f.write(
                f"     ‚Ä¢ C_L/C_D: {best_config['CL_at_max_quality']:.3f}/{best_config['CD_at_max_quality']:.4f} = {best_config['max_quality']:.2f}\n")
            f.write(f"  2. –î–ª—è –∫—Ä–µ–π—Å–µ—Ä—Å–∫–æ–≥–æ –ø–æ–ª–µ—Ç–∞:\n")
            f.write(f"     ‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å: {best_config['cruise_speed']:.1f} –º/—Å\n")
            f.write(f"     ‚Ä¢ –£–≥–æ–ª –∞—Ç–∞–∫–∏: 4.0¬∞\n")
            f.write(
                f"     ‚Ä¢ C_L/C_D: {best_config['CL_target']:.3f}/{best_config['CD_target']:.4f} = {best_config['cruise_quality']:.2f}\n")
            f.write(f"  3. –î–ª—è –≤–∑–ª–µ—Ç–∞/–ø–æ—Å–∞–¥–∫–∏:\n")
            f.write(f"     ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: {best_config['stall_speed']:.1f} –º/—Å\n")
            f.write(f"     ‚Ä¢ –£–≥–æ–ª –∞—Ç–∞–∫–∏: {best_config['CL_max_alpha']:.1f}¬∞\n")
            f.write(
                f"     ‚Ä¢ C_L_max/C_D: {best_config['CL_max']:.3f}/{best_config['CD_at_max_CL']:.4f} = {best_config['quality_at_max_CL']:.2f}\n\n")

            f.write("=" * 70 + "\n")
            f.write("–¢–û–ü-10 –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ô –° –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–ê–ú–ò:\n")
            f.write("=" * 70 + "\n")

            for i, config in enumerate(top_configs[:10], 1):
                f.write(f"\n{i}. {config['airfoil']:12s}\n")
                f.write(
                    f"   –ö—Ä–∏—Ç–µ—Ä–∏–π ({params['sort_criteria']['name']}): {config[params['sort_criteria']['key']]:.3f}\n")
                f.write(f"   –û—Ü–µ–Ω–∫–∞: {config['score']:.1f}\n")
                f.write(
                    f"   –ì–µ–æ–º–µ—Ç—Ä–∏—è: —Ö–æ—Ä–¥–∞ {config['root_chord']:.3f}/{config['tip_chord']:.3f} –º, —Å—Ç—Ä–µ–ª. {config['sweep']:.1f}¬∞, AR={config['aspect_ratio']:.2f}\n")
                f.write(
                    f"   C_L_max: {config['CL_max']:.3f} @ {config['CL_max_alpha']:.1f}¬∞ (C_D={config['CD_at_max_CL']:.4f})\n")
                f.write(f"   C_L –∫—Ä–µ–π—Å–µ—Ä: {config['CL_target']:.3f} (C_D={config['CD_target']:.4f})\n")
                f.write(f"   –ö–∞—á–µ—Å—Ç–≤–æ: –∫—Ä–µ–π—Å–µ—Ä={config['cruise_quality']:.2f}, –º–∞–∫—Å={config['max_quality']:.2f}\n")
                f.write(
                    f"   V_—Å–≤–∞–ª–∏–≤–∞–Ω–∏—è: {config['stall_speed']:.1f} –º/—Å, V_–∫—Ä–µ–π—Å–µ—Ä: {config['cruise_speed']:.1f} –º/—Å\n")

            f.write("\n" + "=" * 70 + "\n")
            f.write("–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ê–ù–ê–õ–ò–ó–ê:\n")
            f.write("=" * 70 + "\n")
            f.write(
                f"–í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π: {len(top_configs) * 10 if len(top_configs) > 10 else len(top_configs) * 5}\n")
            f.write(
                f"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –æ—Ç–≤–µ—á–∞—é—â–∏—Ö –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º: {sum(1 for r in top_configs if r['all_requirements'])}\n")

            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º
            cl_max_values = [c['CL_max'] for c in top_configs]
            cd_values = [c['CD_target'] for c in top_configs]
            quality_values = [c['cruise_quality'] for c in top_configs]

            if cl_max_values:
                f.write(f"\n–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–ê–ú:\n")
                f.write(f"  C_L_max: —Å—Ä–µ–¥–Ω–∏–π={np.mean(cl_max_values):.3f}, –º–∞–∫—Å–∏–º—É–º={max(cl_max_values):.3f}\n")
                f.write(f"  C_D –∫—Ä–µ–π—Å–µ—Ä: —Å—Ä–µ–¥–Ω–∏–π={np.mean(cd_values):.4f}, –º–∏–Ω–∏–º—É–º={min(cd_values):.4f}\n")
                f.write(f"  –ö–∞—á–µ—Å—Ç–≤–æ: —Å—Ä–µ–¥–Ω–µ–µ={np.mean(quality_values):.2f}, –º–∞–∫—Å–∏–º—É–º={max(quality_values):.2f}\n")

        print(f"\n‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª: {filename}")
        return filename
    return None


# ============================================================================
# –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
# ============================================================================

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    print("\n" + "=" * 70)
    print("üõ©Ô∏è  –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –û–ü–¢–ò–ú–ò–ó–ê–¢–û–† –ö–†–´–õ–ê")
    print("–¢–µ–ø–µ—Ä—å —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ C_L –∏ C_D!")
    print("=" * 70)

    try:
        # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        params = get_user_input()
        if params is None:
            print("–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
            sys.exit(0)

        # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
        result = optimize_wing(params)

        if result:
            best_config, top_configs = result
            print("\nüéâ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")

            # –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            export_results(best_config, top_configs, params)

    except KeyboardInterrupt:
        print("\n\n‚ö† –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"\n\n‚ùå –û—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: {e}")
        import traceback
        traceback.print_exc()

    print("\n" + "=" * 70)
    print("–†–ê–ë–û–¢–ê –ó–ê–í–ï–†–®–ï–ù–ê!")
    print("=" * 70)


# ============================================================================
# –ó–ê–ü–£–°–ö –ü–†–û–ì–†–ê–ú–ú–´
# ============================================================================

if __name__ == "__main__":
    main()
    input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞...")
